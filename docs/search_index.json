[["index.html", "Mapy tematyczne w R: ggplot2, tmap Wstp", " Mapy tematyczne w R: ggplot2, tmap Tomasz Klimanek Katedra Statystyki, Uniwersytet Ekonomiczny w Poznaniutomasz.klimanek@ue.poznan.pl 2021-04-19 Wstp Na poprzednich zajciach przedstawione zostay metody tworzenia map tematycznych za pomoc funkcji plot z pakietu base. Celem niniejszych zaje bdzie kontynuacja problematyki tworzenia map tematycznych, ale za pomoc pakietów ggplot2 oraz tmap. "],["wykorzystywane-pakiety.html", "Wykorzystywane pakiety", " Wykorzystywane pakiety Szczegóowe informacje na temat pakietu ggplot2 mozna znale w dokumentacji pakietu na stronie internetowej https://cran.r-project.org/web/packages/ggplot2/index.html. Szczegóowe informacje na temat pakietu tmap mozna znale w dokumentacji pakietu na stronie internetowej https://cran.r-project.org/web/packages/tmap/index.html. W celu stworzenia map tematycznych na dzisiejszych zajciach wykorzystywane bd take nastpujce pakiety: Instalacja pakietów install.packages(&quot;readxl&quot;) install.packages(&quot;sf&quot;) install.packages(&quot;dplyr&quot;) install.packages(&quot;RColorBrewer&quot;) install.packages(&quot;ggplot2&quot;) install.packages(&#39;tmap&#39;) Wczytanie bibliotek library(&quot;readxl&quot;) library(&quot;sf&quot;) library(&quot;dplyr&quot;) library(&quot;RColorBrewer&quot;) library(&quot;ggplot2&quot;) library(&#39;tmap&#39;) "],["tworzenie-prostego-kartogramu-w-1.html", "Tworzenie prostego kartogramu w.1", " Tworzenie prostego kartogramu w.1 Korzystajc z publikacji Bezrobocie rejestrowane. I-IV kwarta 2020 roku, spróbujmy stworzy prosty kartogram zamieszczony na stronie 9 tego opracowania. W pierwszej kolejnoci wczytujemy dane przestrzenne za pomoc funkcji read_sf z pakietu sf, a nastpnie dane atrybutowe dla województw za pomoc funkcji read_xlsx z pakietu readxl. W zbiorze unempl dwuznakowy kod województwa za pomoc funkcji substr i zapisujemy go w zmiennej o nazwie kod_woj2. czymy oba obiekty w jeden zbiór za pomoc funkcji merge deklarujc nazwy zmiennych, po których czymy obydwa zbiory. woj&lt;-read_sf(&quot;dane/gadm36_POL_1.shp&quot;) unempl&lt;-read_xlsx(&quot;dane/woj_un_rate.xlsx&quot;) unempl$KOD_WOJ2&lt;-substr(unempl$KOD_WOJ,1,2) dane_1&lt;-merge(woj,unempl,by.x=&quot;CC_1&quot;,by.y=&quot;KOD_WOJ2&quot;) Stworzenie mapy konturowej województw za pomoc instrukcji ggplot(data=dane), w której deklarujemy obiekt klasy sf za pomoc instrukcji data=. Na kocu linii znajduje si znak + oznaczajcy cig dalszy polecenia. W drugiej linii pojawia si instrukcja geom_sf, dziki której dodajemy geometri zawart we wczeniej zdefiniowanym obiekcie dane. par(mai=rep(0,4),mar=rep(0,4)) ggplot(data=dane_1) + geom_sf() Dodanie tytuu i opisu osi wykresu mapowego. par(mai=rep(0,4),mar=rep(0,4)) ggplot(data=dane_1) + geom_sf() + xlab(&quot;Dugo geograficzna&quot;)+ylab(&quot;Szeroko geograficzna&quot;) + ggtitle(&quot;Mapa 1. Stopa bezrobocia\\nStan w kocu grudnia 2020 r.&quot;, subtitle = &quot;Map 1. Unemployment rate\\nAs of the end of December 2020&quot;) Wyczenie wywietlania siatki i wspórzdnych geograficznych, biae to. dodanie opcji fill=NA w poleceniu geom_sf w celu wyeliminowania szarego ta usuniice linii xlab(Dugo geograficzna)+ylab(Szeroko geograficzna) + dodanie elementów instrukcji theme rect=element_blank() - usunicie ta wntrzna wykresu (midzy osiami) axis.ticks = element_blank() - usunicie znacznikóW osi, axis.text.x = element_blank() - usunicie tekstu osi x, axis.text.y = element_blank() - usunicie tekstu osi y. par(mai=rep(0,4),mar=rep(0,4)) ggplot(data=dane_1) + geom_sf(fill=NA) + ggtitle(&quot;Mapa 1. Stopa bezrobocia\\nStan w kocu grudnia 2020 r.&quot;, subtitle = &quot;Map 1. Unemployment rate\\nAs of the end of December 2020&quot;) + theme(rect=element_blank(), axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank()) Kolorystyka mapy, legenda. intervals&lt;-c(3.6,5.2,6.8,8.4,10.1) dane_1$groups&lt;-as.character(cut(dane_1$UN_RATE,breaks=intervals)) etykiety=c(&quot;3,7 - 5,2&quot;,&quot;5,3 - 6,8&quot;,&quot;6,9 - 8,4&quot;,&quot;8,5 - 10,1&quot;) ile&lt;-as.character(paste0(&quot; (&quot;,as.vector(table(dane_1$groups)),&quot;)&quot;)) etykiety&lt;-paste0(etykiety,ile) pal&lt;-colorRampPalette(c(&quot;#EDF8FB&quot;,&quot;#238B45&quot;))(4) par(mai=rep(0,4),mar=rep(0,4)) ggplot(dane_1) + geom_sf(aes(fill=groups)) + scale_fill_manual(values=pal,labels=etykiety) + ggtitle(&quot;Mapa 1. Stopa bezrobocia\\nStan w kocu grudnia 2020 r.&quot;, subtitle = &quot;Map 1. Unemployment rate\\nAs of the end of December 2020&quot;) + labs(fill=&quot;%&quot;)+ guides(fill=guide_legend(reverse = T)) + theme(rect=element_blank(), axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank(), legend.position = c(0.1,0.15),legend.title.align=0.5,legend.text.align = ) Dodanie adnotacji oraz etykiet - nazw województw i wartoci wskanika. ggplot(dane_1) + geom_sf(aes(fill=groups)) + scale_fill_manual(values=pal,labels=etykiety) + ggtitle(&quot;Mapa 1. Stopa bezrobocia\\nStan w kocu grudnia 2020 r.&quot;, subtitle = &quot;Map 1. Unemployment rate\\nAs of the end of December 2020&quot;) + labs(fill=&quot;%&quot;)+ guides(fill=guide_legend(reverse = T)) + geom_sf_text(mapping=aes(label=NAME_1),size=3)+ geom_sf_text(mapping=aes(label=UN_RATE),size=3,nudge_y = -0.2)+ annotate(&quot;text&quot;,x=15,y=55, label=&quot;Polska = 6,2%&quot;,size=4) + annotate(&quot;text&quot;,x=14.68,y=54.8, label=&quot;Poland&quot;,size=4) + theme(rect=element_blank(), axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank(), axis.title.x = element_blank(), axis.title.y = element_blank(), legend.position = c(0.1,0.15),legend.title.align=0.5,legend.text.align = ) ## Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not give correct results for longitude/latitude data ## Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not give correct results for longitude/latitude data "],["tworzenie-prostego-kartogramu-w-2.html", "Tworzenie prostego kartogramu w.2", " Tworzenie prostego kartogramu w.2 Korzystajc z danych w pliku wynagrodzenia.xlsx, stwórz kartogram prezentujcych rozkad przecitnyh miesicznych wynagrodze brutto w powiatach województwa wielkoplskiego w 2019 roku. W pierwszej kolejnoci wczytujemy dane przestrzenne za pomoc funkcji read_sf z pakietu sf, a nastpnie dane atrybutowe dla powiatów województwa wielkopolskiego za pomoc funkcji read_xlsx z pakietu readxl. Ograniczamy zbiór danych przestrzennych do powiatóW województwa wielkopolskiego i dodatkowo tworzymy w zbiorze mieszk czteroznakowy kod województwa za pomoc funkcji substr i zapisujemy go w zmiennej o nazwie kod_pow2 czymy oba obiekty w jeden zbiór za pomoc funkcji merge deklarujc nazwy zmiennych, po których czymy obydwa zbiory. pow&lt;-read_sf(&quot;dane/gadm36_POL_2.shp&quot;) wages&lt;-read_xlsx(&quot;dane/wynagrodzenia.xlsx&quot;) pow_wlkp&lt;-pow[pow$NAME_1==&#39;Wielkopolskie&#39;,] wages$KOD_POW2&lt;-substr(wages$KOD_POW,1,4) dane_2&lt;-merge(pow_wlkp,wages,by.x=&quot;CC_2&quot;,by.y=&quot;KOD_POW2&quot;) W niniejszym przykadzie skorzystamy z legendy dla zmiennych cigych, dlatego nie dzielimy zmiennoci badanej cech na przedziay. Mapa konturowa powiatóW województwa wielkopolskiego par(mai=rep(0,4),mar=rep(0,4)) ggplot(data=dane_2) + geom_sf() Dodanie tytuu i opisu osi wykresu mapowego. par(mai=rep(0,4),mar=rep(0,4)) ggplot(data=dane_2) + geom_sf() + xlab(&quot;Dugo geograficzna&quot;)+ylab(&quot;Szeroko geograficzna&quot;) + ggtitle(&quot;Przecitne miesiczne Wynagrodzenie brutto w 2019 roku&quot;, subtitle = &quot;Bez podmiotów gospodarczych do 9 osób&quot;) Wyczenie wywietlania siatki i wspórzdnych geograficznych, biae to. par(mai=rep(0,4),mar=rep(0,4)) ggplot(data=dane_2) + geom_sf(fill=NA) + ggtitle(&quot;Przecitne miesiczne Wynagrodzenie brutto w 2019 roku&quot;, subtitle = &quot;Bez podmiotów gospodarczych do 9 osób&quot;) + theme(rect=element_blank(), axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank()) Kolorystyka mapy, legenda. par(mai=rep(0,4),mar=rep(0,4)) ggplot(dane_2) + geom_sf(aes(fill=WAGES)) + scale_fill_continuous(low=&quot;yellow&quot;, high=&quot;red&quot;,name=&quot;Wynagrodzenie\\nw z&quot;) + ggtitle(&quot;Przecitne miesiczne Wynagrodzenie brutto w 2019 roku&quot;, subtitle = &quot;Bez podmiotów gospodarczych do 9 osób&quot;) + theme(rect=element_blank(), axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank(), legend.position = &quot;right&quot;) Dodanie adnotacji oraz etykiet - nazw województw i wartoci wskanika. par(mai=rep(0,4),mar=rep(0,4)) ggplot(dane_2) + geom_sf(aes(fill=WAGES)) + scale_fill_continuous(low=&quot;yellow&quot;, high=&quot;red&quot;,name=&quot;Wynagrodzenie\\nw z&quot;) + ggtitle(&quot;Przecitne miesiczne Wynagrodzenie brutto w 2019 roku&quot;, subtitle = &quot;Bez podmiotów gospodarczych do 9 osób&quot;) + geom_sf_text(mapping=aes(label=NAME_2),size=2.5)+ geom_sf_text(mapping=aes(label=WAGES),size=2.5,nudge_y = -0.05) + annotate(&quot;text&quot;,x=18.5,y=53.5, label=&quot;Polska = 5181,63&quot;,size=3) + annotate(&quot;text&quot;,x=18.5,y=53.3, label=&quot;Wielkopolskie = 4687,39&quot;,size=3) + theme(rect=element_blank(), axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank(), legend.position = &quot;right&quot;, axis.title.x = element_blank(),axis.title.y = element_blank()) ## Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not give correct results for longitude/latitude data ## Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not give correct results for longitude/latitude data "],["tworzenie-prostego-kartogramu-zadanie-1.html", "Tworzenie prostego kartogramu - zadanie 1", " Tworzenie prostego kartogramu - zadanie 1 Korzystajc z publikacji Metropolia Pozna 2010-2019 oraz danych w Banku Danych Lokalnych(https://bdl.stat.gov.pl/BDL/start) spróbuj stworzy prosty kartogram zamieszczony na stronie 22 tego opracowania. "],["kartogramy-w-pakiecie-tmap.html", "Kartogramy w pakiecie tmap", " Kartogramy w pakiecie tmap Na bazie kartogramOw z czci Tworzenie prostego kartogramu w.1 oraz Tworzenie prostego kartogramu w.2, wykonaj je w pakiecie tmap. BEZROBOCIE tm_shape(dane_1) + tm_fill() tm_shape(dane_1) + tm_borders() tm_shape(dane_1) + tm_polygons() tm_shape(dane_1) + tm_fill() + tm_borders() tm_shape(dane_1) + tm_polygons(col = &#39;UN_RATE&#39;) intevals&lt;-c(3.6,5.2,6.8,8.4,10.1) tm_shape(dane_1) + tm_polygons(col = &#39;UN_RATE&#39;,breaks=intervals) intevals&lt;-c(3.6,5.2,6.8,8.4,10.1) tm_shape(dane_1) + tm_polygons(&#39;UN_RATE&#39;,breaks=intervals,palette=&#39;BuGn&#39;) tm_shape(dane_1) + tm_polygons(&#39;UN_RATE&#39;,breaks=intervals,palette=&#39;BuGn&#39;) + tm_compass(type = &quot;8star&quot;, position = c(&quot;left&quot;, &quot;top&quot;)) + tm_scale_bar(breaks = c(0, 100, 200), text.size = 0.7) tm_shape(dane_1) + tm_polygons(&#39;UN_RATE&#39;,breaks=intervals,palette=&#39;BuGn&#39;) + tm_compass(type = &quot;8star&quot;, position = c(&quot;left&quot;, &quot;top&quot;)) + tm_scale_bar(breaks = c(0, 100, 200), text.size = 0.7) + tm_style(&#39;bw&#39;) tm_shape(dane_1) + tm_polygons(&#39;UN_RATE&#39;,breaks=intervals,palette=&#39;BuGn&#39;) + tm_compass(type = &quot;8star&quot;, position = c(&quot;left&quot;, &quot;top&quot;)) + tm_scale_bar(breaks = c(0, 100, 200), text.size = 0.7) + tm_style(&#39;classic&#39;) tm_shape(dane_1) + tm_polygons(&#39;UN_RATE&#39;,breaks=intervals,palette=&#39;BuGn&#39;) + tm_compass(type = &quot;8star&quot;, position = c(&quot;left&quot;, &quot;top&quot;)) + tm_scale_bar(breaks = c(0, 100, 200), text.size = 0.7) + tm_style(&#39;cobalt&#39;) dane_1$groups&lt;-as.character(cut(dane_1$UN_RATE,breaks=intervals)) etykiety=c(&quot;3,7 - 5,2&quot;,&quot;5,3 - 6,8&quot;,&quot;6,9 - 8,4&quot;,&quot;8,5 - 10,1&quot;) ile&lt;-as.character(paste0(&quot; (&quot;,as.vector(table(dane_1$groups)),&quot;)&quot;)) etykiety&lt;-paste0(etykiety,ile) tm_shape(dane_1) + tm_polygons(&#39;UN_RATE&#39;,breaks=intervals,palette=&#39;BuGn&#39;,labels=etykiety,legend.reverse=T, title=&quot;%&quot;) + tm_text(&quot;NAME_1&quot;, size = 0.8)+ tm_shape(dane_1) + tm_text(&#39;UN_RATE&#39;, size=0.8, ymod=-1)+ tm_layout(title=&quot;Mapa 1. Stopa bezrobocia\\nStan w kocu grudnia 2020 r.\\nMap 1. Unemployment rate\\nAs of the end of December 2020&quot;, title.position = c(0.01,0.95),title.size = 0.6, legend.just = &quot;center&quot;, inner.margins=c(0.1, 0.1, 0.1, 0.1))+ tm_credits(&quot;Polska = 6.2%\\nPoland&quot;,position = c(&quot;right&quot;,&quot;top&quot;)) WYNAGRODZENIA tm_shape(dane_2) + tm_polygons(&#39;WAGES&#39;,style=&quot;cont&quot;, title=&quot;Wynagrodzenia w z&quot;) + tm_text(&quot;NAME_2&quot;, size = 1, n=5)+ tm_shape(dane_2) + tm_text(&#39;WAGES&#39;, size=1, ymod=-0.8)+ tm_layout(title=&quot;Przecitne miesiczne Wynagrodzenie brutto w 2019 roku\\nBez podmiotów gospodarczych do 9 osób&quot;, title.position = c(0.01,0.97),title.size = 2, legend.just = &quot;center&quot;, legend.text.size = 1, legend.title.size = 1, inner.margins=c(0.07, 0.07, 0.07, 0.07)) + tm_credits(&quot;Polska = 5181,63\\n\\nWielkopolskie = 4687,39&quot;,position = c(&quot;left&quot;,&quot;bottom&quot;),size = 1) "],["tworzenie-prostego-kartogramu-zadanie-2.html", "Tworzenie prostego kartogramu - zadanie 2", " Tworzenie prostego kartogramu - zadanie 2 Sporzd kartogram z zadania 1 Tworzenie prostego kartogramu - zadanie 1 wykorzystujc pakiet tmap. "]]
